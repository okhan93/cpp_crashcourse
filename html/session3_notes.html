<!DOCTYPE html><html><head>
      <title>session3_notes</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/omarkhan/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.8.19/crossnote/dependencies/katex/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- Dark Mode Styles -->
      <link rel="stylesheet" href="dark-mode.css">
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script>
      <!-- Dark Mode Script -->
      <script src="dark-mode.js"></script>
</head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="session-3-motion-tracking-fundamentals---study-notes">Session 3: Motion Tracking Fundamentals - Study Notes </h1>
<h2 id="table-of-contents">Table of Contents </h2>
<ol>
<li><a href="#why-this-matters">Why This Matters for OptiTrack/VR</a></li>
<li><a href="#coordinate-systems">3D Coordinate Systems</a></li>
<li><a href="#vectors">Vectors - The Foundation</a></li>
<li><a href="#vector-operations">Vector Operations</a></li>
<li><a href="#quaternions">Quaternions - The Right Way to Rotate</a></li>
<li><a href="#transforms">Transforms - Position + Rotation</a></li>
<li><a href="#real-world-applications">Real-World Applications</a></li>
<li><a href="#interview-questions">Common Interview Questions</a></li>
</ol>
<hr>
<p><a name="why-this-matters" href=""></a></p>
<h2 id="1-why-this-matters-for-optitrackvr">1. Why This Matters for OptiTrack/VR </h2>
<h3 id="what-optitrack-does">What OptiTrack Does </h3>
<p>OptiTrack cameras track <strong>reflective markers</strong> in 3D space. When you wear a VR headset with markers attached:</p>
<ol>
<li>Cameras detect marker positions (x, y, z coordinates)</li>
<li>Software calculates the headset's <strong>position</strong> and <strong>rotation</strong></li>
<li>VR system uses this to update what you see</li>
</ol>
<h3 id="the-math-you-need">The Math You Need </h3>
<ul>
<li><strong>Vectors:</strong> Represent positions, directions, velocities</li>
<li><strong>Quaternions:</strong> Represent rotations (better than Euler angles)</li>
<li><strong>Transforms:</strong> Combine position + rotation to describe object state</li>
</ul>
<p><strong>In interviews, they want to see you understand the 3D math behind tracking systems.</strong></p>
<hr>
<p><a name="coordinate-systems" href=""></a></p>
<h2 id="2-3d-coordinate-systems">2. 3D Coordinate Systems </h2>
<h3 id="right-handed-coordinate-system-optitrack-standard">Right-Handed Coordinate System (OptiTrack Standard) </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>      Y (up)
      |
      |
      +------ X (right)
     /
    /
   Z (forward toward you)
</code></pre><p><strong>Conventions:</strong></p>
<ul>
<li><strong>X-axis:</strong> Right</li>
<li><strong>Y-axis:</strong> Up</li>
<li><strong>Z-axis:</strong> Forward (toward you in OpenGL/OptiTrack)</li>
</ul>
<h3 id="world-space-vs-local-space">World Space vs Local Space </h3>
<p><strong>World Space:</strong> The global coordinate system (the room)</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>VR Headset at world position (2, 1.5, 3)
</code></pre><p><strong>Local Space:</strong> Relative to an object</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Marker on headset at local position (0.1, 0.05, -0.1) relative to headset center
</code></pre><p><strong>Transformation:</strong> Converting local → world coordinates</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>World Position = Object Position + Rotate(Local Position)
</code></pre><hr>
<p><a name="vectors" href=""></a></p>
<h2 id="3-vectors---the-foundation">3. Vectors - The Foundation </h2>
<h3 id="what-is-a-vector">What is a Vector? </h3>
<p>A vector is a <strong>direction and magnitude</strong> in 3D space.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Vec3</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Vec3 position <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">// A point in space</span>
Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// Movement direction and speed</span>
Vec3 forward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">// Direction headset is facing</span>
</code></pre><h3 id="visualizing-vectors">Visualizing Vectors </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>    (x=2, y=3)
      *
     /|
    / |
   /  | y=3
  /   |
 /____|
   x=2

Magnitude (length) = sqrt(2² + 3²) = sqrt(13) ≈ 3.6
</code></pre><h3 id="types-of-vectors">Types of Vectors </h3>
<p><strong>Position Vector:</strong> A point in space</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 headsetPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">1.8f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Headset location</span>
</code></pre><p><strong>Direction Vector:</strong> Which way something is pointing (usually normalized)</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 forward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// Looking forward</span>
</code></pre><p><strong>Velocity Vector:</strong> Speed and direction of movement</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// Moving right at 0.1 units/frame</span>
</code></pre><hr>
<p><a name="vector-operations" href=""></a></p>
<h2 id="4-vector-operations">4. Vector Operations </h2>
<h3 id="vector-addition-">Vector Addition (+) </h3>
<p><strong>Use case:</strong> Applying offsets, combining movements</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v1 = (1, 2, 3)
v2 = (4, 5, 6)
v1 + v2 = (1+4, 2+5, 3+6) = (5, 7, 9)
</code></pre><p><strong>Basic Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 position <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 offset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 newPosition <span class="token operator">=</span> position <span class="token operator">+</span> offset<span class="token punctuation">;</span>  <span class="token comment">// Move 0.1 units to the right</span>
</code></pre><p><strong>Real-World OptiTrack/VR Applications:</strong></p>
<ol>
<li>
<p><strong>Applying motion/velocity to position</strong> (Every frame in VR)</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Update headset position based on velocity</span>
Vec3 currentPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.01f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Moving right</span>
Vec3 newPos <span class="token operator">=</span> currentPos <span class="token operator">+</span> velocity<span class="token punctuation">;</span>
headset<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>newPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Offset calculations for mounted devices</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Camera mounted 2 meters above the tracking origin</span>
Vec3 trackingOrigin <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 cameraOffset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 cameraPosition <span class="token operator">=</span> trackingOrigin <span class="token operator">+</span> cameraOffset<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Combining multiple movements</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Patient wearing headset walks while head moves</span>
Vec3 bodyMovement <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">// Walking</span>
Vec3 headMovement <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Slight head bob</span>
Vec3 totalMovement <span class="token operator">=</span> bodyMovement <span class="token operator">+</span> headMovement<span class="token punctuation">;</span>
Vec3 newHeadsetPos <span class="token operator">=</span> currentPos <span class="token operator">+</span> totalMovement<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Marker position relative to rigid body center</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// VR controller has 4 markers. Calculate world position of each marker</span>
Vec3 controllerCenter <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 marker1LocalOffset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.02f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 marker1WorldPos <span class="token operator">=</span> controllerCenter <span class="token operator">+</span> marker1LocalOffset<span class="token punctuation">;</span>
</code></pre></li>
</ol>
<p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Vec3<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">+</span> other<span class="token punctuation">.</span>z<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="vector-subtraction--">Vector Subtraction (-) </h3>
<p><strong>Use case:</strong> Finding direction between two points</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v1 = (5, 3, 2)
v2 = (2, 1, 1)
v1 - v2 = (3, 2, 1)  // Direction from v2 to v1
</code></pre><p><strong>Basic Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 headPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 controllerPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 direction <span class="token operator">=</span> headPos <span class="token operator">-</span> controllerPos<span class="token punctuation">;</span>  <span class="token comment">// Vector pointing from controller to head</span>
</code></pre><p><strong>Real-World OptiTrack/VR Applications:</strong></p>
<ol>
<li>
<p><strong>Calculate direction to look at a target</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// VR headset needs to face a surgical target</span>
Vec3 headsetPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.8f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 targetPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2.5f</span><span class="token punctuation">,</span> <span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 directionToTarget <span class="token operator">=</span> <span class="token punctuation">(</span>targetPos <span class="token operator">-</span> headsetPos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Now headset knows which way to rotate to face target</span>
</code></pre></li>
<li>
<p><strong>Distance calculation between tracked objects</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// How far apart are the left and right controllers?</span>
Vec3 leftController <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 rightController <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 diff <span class="token operator">=</span> rightController <span class="token operator">-</span> leftController<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> diff<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0.6 meters apart</span>
</code></pre></li>
<li>
<p><strong>Velocity calculation</strong> (Critical for medical tracking precision)</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Track how fast surgeon's hand is moving</span>
Vec3 currentPos <span class="token operator">=</span> tool<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 previousPos <span class="token operator">=</span> tool<span class="token punctuation">.</span><span class="token function">getPreviousPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token number">120.0f</span><span class="token punctuation">;</span>  <span class="token comment">// 120 FPS tracking</span>
Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">(</span>currentPos <span class="token operator">-</span> previousPos<span class="token punctuation">)</span> <span class="token operator">/</span> deltaTime<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> speed <span class="token operator">=</span> velocity<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>speed <span class="token operator">&gt;</span> <span class="token number">0.5f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Warning: Hand moving too fast for precision surgery</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>Detecting collision/proximity</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Is the surgical tool getting too close to a restricted zone?</span>
Vec3 toolTip <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 dangerZone <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 separation <span class="token operator">=</span> toolTip <span class="token operator">-</span> dangerZone<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> separation<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;</span> <span class="token number">0.1f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Less than 10cm</span>
    <span class="token comment">// Alert: Too close to danger zone!</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>Relative positioning for UI elements</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Place a virtual menu 0.5m in front of headset</span>
Vec3 headsetPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 forward <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 menuPos <span class="token operator">=</span> headsetPos <span class="token operator">+</span> <span class="token punctuation">(</span>forward <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// But first we needed: forward = rotate({0,0,-1}) using headset rotation</span>
</code></pre></li>
</ol>
<p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Vec3<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">-</span> other<span class="token punctuation">.</span>z<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="scalar-multiplication-">Scalar Multiplication (*) </h3>
<p><strong>Use case:</strong> Scaling vectors (change magnitude, keep direction)</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v = (2, 3, 1)
v * 2 = (4, 6, 2)  // Twice as long, same direction
</code></pre><p><strong>Basic Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 fastVelocity <span class="token operator">=</span> velocity <span class="token operator">*</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>  <span class="token comment">// 3x speed</span>
</code></pre><p><strong>Real-World OptiTrack/VR Applications:</strong></p>
<ol>
<li>
<p><strong>Moving along a direction at specific speed</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Move headset 0.5 meters forward</span>
Vec3 forward <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Normalized direction</span>
Vec3 movement <span class="token operator">=</span> forward <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>    <span class="token comment">// Scale to desired distance</span>
Vec3 newPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> movement<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Adjusting velocity/speed</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Slow down a fast-moving tracked object for smoother visualization</span>
Vec3 rawVelocity <span class="token operator">=</span> <span class="token function">calculateVelocity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> smoothingFactor <span class="token operator">=</span> <span class="token number">0.7f</span><span class="token punctuation">;</span>  <span class="token comment">// 70% of original speed</span>
Vec3 smoothedVelocity <span class="token operator">=</span> rawVelocity <span class="token operator">*</span> smoothingFactor<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Interpolation (lerp) between positions</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Smooth camera movement from startPos to endPos</span>
Vec3 startPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 endPos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> t <span class="token operator">=</span> <span class="token number">0.3f</span><span class="token punctuation">;</span>  <span class="token comment">// 30% of the way</span>
Vec3 currentPos <span class="token operator">=</span> startPos <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>endPos <span class="token operator">-</span> startPos<span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Result: (1.5, 1.0, 0.0) - 30% from start to end</span>
</code></pre></li>
<li>
<p><strong>Applying forces/accelerations</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Simulate gravity on a virtual object in VR</span>
Vec3 gravity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">9.8f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// m/s²</span>
<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token number">120.0f</span><span class="token punctuation">;</span>     <span class="token comment">// Frame time</span>
Vec3 velocityChange <span class="token operator">=</span> gravity <span class="token operator">*</span> deltaTime<span class="token punctuation">;</span>
velocity <span class="token operator">=</span> velocity <span class="token operator">+</span> velocityChange<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Offset positioning at variable distances</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Place UI elements at user-preferred distance</span>
Vec3 forward <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> userPreferredDistance <span class="token operator">=</span> <span class="token number">0.6f</span><span class="token punctuation">;</span>  <span class="token comment">// 60cm from face</span>
Vec3 uiPosition <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>forward <span class="token operator">*</span> userPreferredDistance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> scalar<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">*</span> scalar<span class="token punctuation">,</span> y <span class="token operator">*</span> scalar<span class="token punctuation">,</span> z <span class="token operator">*</span> scalar<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="magnitude-length">Magnitude (Length) </h3>
<p><strong>Use case:</strong> How far? How fast? Distance from origin.</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v = (3, 4, 0)
|v| = sqrt(3² + 4² + 0²) = sqrt(9 + 16) = sqrt(25) = 5
</code></pre><p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> speed <span class="token operator">=</span> velocity<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// = 5.0</span>
</code></pre><p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> <span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x<span class="token operator">*</span>x <span class="token operator">+</span> y<span class="token operator">*</span>y <span class="token operator">+</span> z<span class="token operator">*</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="normalization-unit-vector">Normalization (Unit Vector) </h3>
<p><strong>Use case:</strong> Direction without magnitude (length = 1)</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v = (3, 4, 0)
|v| = 5
normalized = (3/5, 4/5, 0/5) = (0.6, 0.8, 0)
|normalized| = 1
</code></pre><p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 direction <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 unitDirection <span class="token operator">=</span> direction<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (0.6, 0.8, 0) - same direction, length 1</span>
</code></pre><p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> mag <span class="token operator">=</span> <span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Avoid division by zero</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">/</span> mag<span class="token punctuation">,</span> y <span class="token operator">/</span> mag<span class="token punctuation">,</span> z <span class="token operator">/</span> mag<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Why normalize?</strong></p>
<ul>
<li>Rotations require unit vectors</li>
<li>Comparing directions (ignoring magnitude)</li>
<li>Consistent movement speed</li>
</ul>
<h3 id="dot-product-">Dot Product (·) </h3>
<p><strong>Use case:</strong> Angle between vectors, projection, checking if perpendicular</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v1 = (1, 0, 0)
v2 = (0, 1, 0)
v1 · v2 = (1×0) + (0×1) + (0×0) = 0  (perpendicular!)
</code></pre><p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Vec3<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> x<span class="token operator">*</span>other<span class="token punctuation">.</span>x <span class="token operator">+</span> y<span class="token operator">*</span>other<span class="token punctuation">.</span>y <span class="token operator">+</span> z<span class="token operator">*</span>other<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Relationship to angle:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v1 · v2 = |v1| × |v2| × cos(θ)

For unit vectors:
v1 · v2 = cos(θ)
</code></pre><p><strong>Interpretation:</strong></p>
<ul>
<li><code>dot = 1</code>: Same direction (0° angle)</li>
<li><code>dot = 0</code>: Perpendicular (90° angle)</li>
<li><code>dot = -1</code>: Opposite direction (180° angle)</li>
<li><code>dot &gt; 0</code>: Less than 90° apart</li>
<li><code>dot &lt; 0</code>: More than 90° apart</li>
</ul>
<p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 forward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 toTarget <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> alignment <span class="token operator">=</span> forward<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>toTarget<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// If alignment &gt; 0.7, target is in front of you</span>
</code></pre><h3 id="cross-product-">Cross Product (×) </h3>
<p><strong>Use case:</strong> Find perpendicular vector, calculate rotation axis</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v1 = (1, 0, 0)  // X-axis
v2 = (0, 1, 0)  // Y-axis
v1 × v2 = (0, 0, 1)  // Z-axis (perpendicular to both)
</code></pre><p><strong>Formula:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token function">cross</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Vec3<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>
        y <span class="token operator">*</span> other<span class="token punctuation">.</span>z <span class="token operator">-</span> z <span class="token operator">*</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span>  <span class="token comment">// x component</span>
        z <span class="token operator">*</span> other<span class="token punctuation">.</span>x <span class="token operator">-</span> x <span class="token operator">*</span> other<span class="token punctuation">.</span>z<span class="token punctuation">,</span>  <span class="token comment">// y component</span>
        x <span class="token operator">*</span> other<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> other<span class="token punctuation">.</span>x   <span class="token comment">// z component</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Properties:</strong></p>
<ul>
<li><strong>Order matters:</strong> <code>v1 × v2 = -(v2 × v1)</code></li>
<li><strong>Right-hand rule:</strong> Curl fingers from v1 to v2, thumb points to result</li>
<li><strong>Result is perpendicular</strong> to both input vectors</li>
<li><strong>Magnitude = |v1| × |v2| × sin(θ)</strong> (area of parallelogram)</li>
</ul>
<p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 up <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 forward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 right <span class="token operator">=</span> up<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>forward<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (1, 0, 0)</span>
</code></pre><hr>
<p><a name="quaternions" href=""></a></p>
<h2 id="5-quaternions---the-right-way-to-rotate">5. Quaternions - The Right Way to Rotate </h2>
<h3 id="the-problem-with-euler-angles">The Problem with Euler Angles </h3>
<p><strong>Euler angles:</strong> Rotation as three angles (pitch, yaw, roll)</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">EulerAngles</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> pitch<span class="token punctuation">;</span>  <span class="token comment">// Rotation around X (nodding)</span>
    <span class="token keyword keyword-float">float</span> yaw<span class="token punctuation">;</span>    <span class="token comment">// Rotation around Y (shaking head "no")</span>
    <span class="token keyword keyword-float">float</span> roll<span class="token punctuation">;</span>   <span class="token comment">// Rotation around Z (tilting head)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>Problems:</strong></p>
<ol>
<li><strong>Gimbal Lock:</strong> At certain angles, you lose a degree of freedom
<ul>
<li>Pitch to 90° → roll and yaw become the same axis!</li>
</ul>
</li>
<li><strong>Interpolation:</strong> Can't smoothly blend between rotations</li>
<li><strong>Order dependent:</strong> XYZ rotation ≠ ZYX rotation</li>
</ol>
<p><strong>Why VR cares:</strong> When you look up (pitch 90°), the headset can't distinguish roll from yaw = BAD tracking!</p>
<h3 id="what-is-a-quaternion">What is a Quaternion? </h3>
<p>A quaternion is a <strong>4D number</strong> that represents rotation:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Quaternion</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>  <span class="token comment">// Vector part (rotation axis)</span>
    <span class="token keyword keyword-float">float</span> w<span class="token punctuation">;</span>        <span class="token comment">// Scalar part (rotation amount)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>Think of it as:</strong> "Rotate by angle θ around axis (x, y, z)"</p>
<h3 id="axis-angle-representation">Axis-Angle Representation </h3>
<p><strong>Most intuitive way to think about rotation:</strong></p>
<ul>
<li><strong>Axis:</strong> Direction vector (normalized)</li>
<li><strong>Angle:</strong> How much to rotate around that axis</li>
</ul>
<p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Rotate 90° around Y-axis:
  axis = (0, 1, 0)
  angle = π/2 (90 degrees in radians)
</code></pre><p><strong>Converting to Quaternion:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token function">Quaternion</span><span class="token punctuation">(</span>Vec3 axis<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> angleRadians<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vec3 normalizedAxis <span class="token operator">=</span> axis<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> halfAngle <span class="token operator">=</span> angleRadians <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> sinHalf <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>halfAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>

    x <span class="token operator">=</span> normalizedAxis<span class="token punctuation">.</span>x <span class="token operator">*</span> sinHalf<span class="token punctuation">;</span>
    y <span class="token operator">=</span> normalizedAxis<span class="token punctuation">.</span>y <span class="token operator">*</span> sinHalf<span class="token punctuation">;</span>
    z <span class="token operator">=</span> normalizedAxis<span class="token punctuation">.</span>z <span class="token operator">*</span> sinHalf<span class="token punctuation">;</span>
    w <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>halfAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Why half angle?</strong> Math reasons (quaternion double-cover property) - just remember to use <code>angle/2</code>.</p>
<h3 id="quaternion-multiplication-combining-rotations">Quaternion Multiplication (Combining Rotations) </h3>
<p><strong>Use case:</strong> Apply multiple rotations</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Quaternion <span class="token function">rotate90Y</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Rotate 90° around Y</span>
Quaternion <span class="token function">rotate45Z</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Then rotate 45° around Z</span>
Quaternion combined <span class="token operator">=</span> rotate45Z <span class="token operator">*</span> rotate90Y<span class="token punctuation">;</span> <span class="token comment">// Combined rotation</span>
</code></pre><p><strong>Important:</strong> <strong>Order matters!</strong> <code>q1 * q2 ≠ q2 * q1</code></p>
<p><strong>Formula:</strong> (You don't need to memorize, just implement from TODO)</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Quaternion <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Quaternion<span class="token operator">&amp;</span> q<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    Quaternion result<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>w <span class="token operator">=</span> w<span class="token operator">*</span>q<span class="token punctuation">.</span>w <span class="token operator">-</span> x<span class="token operator">*</span>q<span class="token punctuation">.</span>x <span class="token operator">-</span> y<span class="token operator">*</span>q<span class="token punctuation">.</span>y <span class="token operator">-</span> z<span class="token operator">*</span>q<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>x <span class="token operator">=</span> w<span class="token operator">*</span>q<span class="token punctuation">.</span>x <span class="token operator">+</span> x<span class="token operator">*</span>q<span class="token punctuation">.</span>w <span class="token operator">+</span> y<span class="token operator">*</span>q<span class="token punctuation">.</span>z <span class="token operator">-</span> z<span class="token operator">*</span>q<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>y <span class="token operator">=</span> w<span class="token operator">*</span>q<span class="token punctuation">.</span>y <span class="token operator">-</span> x<span class="token operator">*</span>q<span class="token punctuation">.</span>z <span class="token operator">+</span> y<span class="token operator">*</span>q<span class="token punctuation">.</span>w <span class="token operator">+</span> z<span class="token operator">*</span>q<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>z <span class="token operator">=</span> w<span class="token operator">*</span>q<span class="token punctuation">.</span>z <span class="token operator">+</span> x<span class="token operator">*</span>q<span class="token punctuation">.</span>y <span class="token operator">-</span> y<span class="token operator">*</span>q<span class="token punctuation">.</span>x <span class="token operator">+</span> z<span class="token operator">*</span>q<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="rotating-a-vector-with-a-quaternion">Rotating a Vector with a Quaternion </h3>
<p><strong>Use case:</strong> Apply headset rotation to a forward vector</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 localForward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Quaternion headsetRotation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
Vec3 worldForward <span class="token operator">=</span> headsetRotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>localForward<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>Simplified formula:</strong> (Efficient version)</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Vec3<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    Vec3 qvec <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">}</span><span class="token punctuation">;</span>
    Vec3 uv <span class="token operator">=</span> qvec<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Vec3 uuv <span class="token operator">=</span> qvec<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> v <span class="token operator">+</span> <span class="token punctuation">(</span>uv <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2.0f</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>uuv <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="identity-quaternion-no-rotation">Identity Quaternion (No Rotation) </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Quaternion identity <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// No rotation</span>
</code></pre><h3 id="why-quaternions-are-better">Why Quaternions are Better </h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Euler Angles</th>
<th>Quaternions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gimbal lock</td>
<td>✗ Yes</td>
<td>✓ No</td>
</tr>
<tr>
<td>Smooth interpolation</td>
<td>✗ Hard</td>
<td>✓ Easy (SLERP)</td>
</tr>
<tr>
<td>Combining rotations</td>
<td>✗ Complex</td>
<td>✓ Simple (multiply)</td>
</tr>
<tr>
<td>Memory</td>
<td>3 floats</td>
<td>4 floats</td>
</tr>
<tr>
<td>Human-readable</td>
<td>✓ Yes</td>
<td>✗ No</td>
</tr>
</tbody>
</table>
<p><strong>For VR/OptiTrack:</strong> Always use quaternions for internal representation.</p>
<hr>
<p><a name="transforms" href=""></a></p>
<h2 id="6-transforms---position--rotation">6. Transforms - Position + Rotation </h2>
<h3 id="what-is-a-transform">What is a Transform? </h3>
<p>A <strong>transform</strong> describes an object's state in 3D space:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Transform</span> <span class="token punctuation">{</span>
    Vec3 position<span class="token punctuation">;</span>        <span class="token comment">// Where is it?</span>
    Quaternion rotation<span class="token punctuation">;</span>  <span class="token comment">// Which way is it facing?</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>(Sometimes also includes <code>scale</code>, but OptiTrack rigid bodies don't scale)</p>
<h3 id="local-to-world-transformation">Local to World Transformation </h3>
<p><strong>Problem:</strong> You have a marker's position relative to a headset. Where is it in the room?</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token function">transformPoint</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Vec3<span class="token operator">&amp;</span> localPoint<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. Rotate the local point by the object's rotation</span>
    Vec3 rotated <span class="token operator">=</span> rotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>localPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. Add the object's position</span>
    <span class="token keyword keyword-return">return</span> rotated <span class="token operator">+</span> position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Headset Transform:
  position = (2, 1.5, 3)
  rotation = 90° around Y

Local marker position: (0.1, 0, 0)  // 0.1m to the right of headset center

World position = rotate(0.1, 0, 0) + (2, 1.5, 3)
               = (0, 0, -0.1) + (2, 1.5, 3)    // After 90° Y rotation, right becomes -forward
               = (2, 1.5, 2.9)
</code></pre><h3 id="direction-vectors">Direction Vectors </h3>
<p>Objects have <strong>local</strong> direction vectors:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 localForward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// -Z is forward (OpenGL convention)</span>
Vec3 localUp <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">// +Y is up</span>
Vec3 localRight <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment">// +X is right</span>
</code></pre><p><strong>Getting world-space directions:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> rotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Vec3 <span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> rotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Vec3 <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> rotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Use case:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Transform headset <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
Vec3 lookDirection <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Which way is the user looking?</span>

<span class="token comment">// Move 0.5 units in the direction the headset is facing</span>
Vec3 newPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>lookDirection <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<p><a name="matrices" href=""></a></p>
<h2 id="65-matrices---combining-transformations">6.5. Matrices - Combining Transformations </h2>
<h3 id="why-matrices-matter">Why Matrices Matter </h3>
<p>While Vec3 + Quaternion works conceptually, <strong>real systems use matrices</strong> because:</p>
<ul>
<li>GPU optimized for matrix operations</li>
<li>Single operation combines rotation + translation</li>
<li>Essential for camera calibration</li>
<li>Standard in OptiTrack SDK</li>
</ul>
<h3 id="3x3-matrix---rotation-only">3x3 Matrix - Rotation Only </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> mat<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>r00<span class="token punctuation">,</span> r01<span class="token punctuation">,</span> r02<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// First row</span>
    <span class="token punctuation">{</span>r10<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> r12<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Second row</span>
    <span class="token punctuation">{</span>r20<span class="token punctuation">,</span> r21<span class="token punctuation">,</span> r22<span class="token punctuation">}</span>   <span class="token comment">// Third row</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>Use cases:</strong></p>
<ul>
<li>Rotation transformations</li>
<li>Camera intrinsic parameters</li>
<li>Coordinate system changes</li>
</ul>
<p><strong>Rotation around Y-axis (90°):</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Mat3 rotY <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// cos(90°)=0, sin(90°)=1</span>
    <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Vec3 point <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 rotated <span class="token operator">=</span> rotY <span class="token operator">*</span> point<span class="token punctuation">;</span>  <span class="token comment">// Result: (0, 0, -1)</span>
</code></pre><h3 id="4x4-matrix---the-transform-matrix">4x4 Matrix - THE Transform Matrix </h3>
<p><strong>This is what OptiTrack SDK actually uses!</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> transform<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>r00<span class="token punctuation">,</span> r01<span class="token punctuation">,</span> r02<span class="token punctuation">,</span> tx<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Rotation + X translation</span>
    <span class="token punctuation">{</span>r10<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> r12<span class="token punctuation">,</span> ty<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Rotation + Y translation</span>
    <span class="token punctuation">{</span>r20<span class="token punctuation">,</span> r21<span class="token punctuation">,</span> r22<span class="token punctuation">,</span> tz<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Rotation + Z translation</span>
    <span class="token punctuation">{</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">}</span>   <span class="token comment">// Homogeneous coordinate</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>Structure breakdown:</strong></p>
<ul>
<li><strong>Upper-left 3x3</strong>: Rotation (same as Mat3)</li>
<li><strong>Right column (tx, ty, tz)</strong>: Translation</li>
<li><strong>Bottom row</strong>: Always [0, 0, 0, 1] for standard transforms</li>
</ul>
<h3 id="homogeneous-coordinates">Homogeneous Coordinates </h3>
<p><strong>To use 4x4 matrices, vectors become 4D:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Position (point in space)</span>
Vec4 position <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// w=1</span>

<span class="token comment">// Direction (no position, just direction)</span>
Vec4 direction <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// w=0</span>
</code></pre><p><strong>Why w=1 vs w=0?</strong></p>
<ul>
<li><code>w=1</code>: Affected by translation (it's a point)</li>
<li><code>w=0</code>: NOT affected by translation (it's a direction)</li>
</ul>
<p><strong>Example:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Mat4 transform <span class="token operator">=</span> <span class="token comment">/* rotation + translation (5, 2, 0) */</span><span class="token punctuation">;</span>

Vec4 point <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token comment">// w=1</span>
Vec4 transformedPoint <span class="token operator">=</span> transform <span class="token operator">*</span> point<span class="token punctuation">;</span>  <span class="token comment">// Gets rotated AND translated</span>

Vec4 direction <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// w=0</span>
Vec4 transformedDir <span class="token operator">=</span> transform <span class="token operator">*</span> direction<span class="token punctuation">;</span>  <span class="token comment">// Only rotated, NO translation</span>
</code></pre><h3 id="matrix-multiplication---combining-transforms">Matrix Multiplication - Combining Transforms </h3>
<p><strong>Key insight:</strong> Multiply matrices to combine transformations</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Headset transform</span>
Mat4 headsetTransform <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token comment">// Marker offset (local to headset)</span>
Mat4 markerOffset <span class="token operator">=</span> <span class="token class-name">Mat4</span><span class="token double-colon punctuation">::</span><span class="token function">translation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Combined: marker position in world space</span>
Mat4 markerWorld <span class="token operator">=</span> headsetTransform <span class="token operator">*</span> markerOffset<span class="token punctuation">;</span>

<span class="token comment">// Transform a point</span>
Vec3 localPoint <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 worldPoint <span class="token operator">=</span> markerWorld<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>localPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>Order matters!</strong> <code>A * B ≠ B * A</code></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Rotate THEN translate</span>
Mat4 result1 <span class="token operator">=</span> translation <span class="token operator">*</span> rotation<span class="token punctuation">;</span>

<span class="token comment">// Translate THEN rotate (different result!)</span>
Mat4 result2 <span class="token operator">=</span> rotation <span class="token operator">*</span> translation<span class="token punctuation">;</span>
</code></pre><h3 id="real-optitrack-sdk-example">Real OptiTrack SDK Example </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// From NatNet SDK</span>
sRigidBodyData<span class="token operator">*</span> rigidBody<span class="token punctuation">;</span>

<span class="token comment">// OptiTrack provides a 4x4 matrix (flattened to 1D array)</span>
<span class="token keyword keyword-float">float</span> transform<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// Actually 4x4, stored as 1D</span>
rigidBody<span class="token operator">-&gt;</span><span class="token function">GetTransformMatrix</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use it to transform markers</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numMarkers<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vec3 markerLocal <span class="token operator">=</span> markerPositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    Vec3 markerWorld <span class="token operator">=</span> <span class="token function">transformPoint</span><span class="token punctuation">(</span>transform<span class="token punctuation">,</span> markerLocal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="when-to-use-what">When to Use What? </h3>
<table>
<thead>
<tr>
<th>Representation</th>
<th>Storage</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vec3 + Quaternion</td>
<td>7 floats</td>
<td>Conceptual understanding, storage</td>
</tr>
<tr>
<td>3x3 Matrix</td>
<td>9 floats</td>
<td>Rotation only, camera calibration</td>
</tr>
<tr>
<td>4x4 Matrix</td>
<td>16 floats</td>
<td>GPU operations, combining transforms</td>
</tr>
</tbody>
</table>
<p><strong>In practice:</strong></p>
<ul>
<li><strong>Store:</strong> Quaternion (compact)</li>
<li><strong>Compute:</strong> 4x4 Matrix (fast)</li>
<li><strong>Convert:</strong> Between them as needed</li>
</ul>
<h3 id="common-matrix-operations">Common Matrix Operations </h3>
<p><strong>Identity matrix (no transformation):</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Mat4 identity <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>Translation matrix:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Mat4 <span class="token function">translation</span><span class="token punctuation">(</span>Vec3 t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>z<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Rotation matrix around Y-axis:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Mat4 <span class="token function">rotationY</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> angle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> c <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> s <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="practical-applications">Practical Applications </h3>
<p><strong>1. Camera Calibration</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Intrinsic matrix (3x3) - maps 3D → 2D</span>
Mat3 K <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>fx<span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Focal length &amp; principal point</span>
    <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cy<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Project 3D point to 2D image</span>
Vec3 point3D <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 projected <span class="token operator">=</span> K <span class="token operator">*</span> <span class="token punctuation">(</span>point3D <span class="token operator">/</span> point3D<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Perspective division</span>
Vec2 pixel <span class="token operator">=</span> <span class="token punctuation">{</span>projected<span class="token punctuation">.</span>x<span class="token punctuation">,</span> projected<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>2. Multi-camera setup</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Each OptiTrack camera has position + rotation</span>
Mat4 camera1Transform <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
Mat4 camera2Transform <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token comment">// Convert point from camera1 space to camera2 space</span>
Mat4 camera1ToWorld <span class="token operator">=</span> camera1Transform<span class="token punctuation">;</span>
Mat4 worldToCamera2 <span class="token operator">=</span> <span class="token function">inverse</span><span class="token punctuation">(</span>camera2Transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat4 camera1ToCamera2 <span class="token operator">=</span> worldToCamera2 <span class="token operator">*</span> camera1ToWorld<span class="token punctuation">;</span>
</code></pre><p><strong>3. Hierarchical transforms (parent-child)</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Headset transform</span>
Mat4 headsetTransform <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token comment">// Eye offset (children of headset)</span>
Mat4 leftEyeOffset <span class="token operator">=</span> <span class="token class-name">Mat4</span><span class="token double-colon punctuation">::</span><span class="token function">translation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">0.03</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat4 rightEyeOffset <span class="token operator">=</span> <span class="token class-name">Mat4</span><span class="token double-colon punctuation">::</span><span class="token function">translation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0.03</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// World positions of eyes</span>
Mat4 leftEyeWorld <span class="token operator">=</span> headsetTransform <span class="token operator">*</span> leftEyeOffset<span class="token punctuation">;</span>
Mat4 rightEyeWorld <span class="token operator">=</span> headsetTransform <span class="token operator">*</span> rightEyeOffset<span class="token punctuation">;</span>
</code></pre><hr>
<p><a name="real-world-applications" href=""></a></p>
<h2 id="7-real-world-applications">7. Real-World Applications </h2>
<h3 id="optitrack-tracking-pipeline">OptiTrack Tracking Pipeline </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. Cameras detect marker positions (2D in each camera)
   ↓
2. Triangulation → 3D marker positions in world space
   ↓
3. Marker clustering → Identify which markers belong to which rigid body
   ↓
4. Rigid body pose estimation → Calculate position + rotation (quaternion)
   ↓
5. Send to VR application → Update headset/controller transforms
</code></pre><h3 id="common-calculations">Common Calculations </h3>
<p><strong>Distance between headset and controller:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 headPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 controllerPos <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 diff <span class="token operator">=</span> headPos <span class="token operator">-</span> controllerPos<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> diff<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>Is target in front of headset?</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 toTarget <span class="token operator">=</span> targetPos <span class="token operator">-</span> headsetPos<span class="token punctuation">;</span>
Vec3 forward <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> alignment <span class="token operator">=</span> toTarget<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>forward<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>alignment <span class="token operator">&gt;</span> <span class="token number">0.7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// cos(45°) ≈ 0.7</span>
    <span class="token comment">// Target is in front</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Calculate velocity:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 currentPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 previousPos <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token number">120.0f</span><span class="token punctuation">;</span>  <span class="token comment">// 120 FPS</span>
Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">(</span>currentPos <span class="token operator">-</span> previousPos<span class="token punctuation">)</span> <span class="token operator">/</span> deltaTime<span class="token punctuation">;</span>
</code></pre><p><strong>Smooth rotation interpolation (SLERP):</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Blend between two rotations smoothly</span>
Quaternion <span class="token function">slerp</span><span class="token punctuation">(</span>Quaternion q1<span class="token punctuation">,</span> Quaternion q2<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// t = 0 → q1, t = 1 → q2, t = 0.5 → halfway</span>
    <span class="token comment">// (Implementation complex, but concept simple)</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h2 id="75-understanding-the-tests---practical-walkthrough">7.5. Understanding the Tests - Practical Walkthrough </h2>
<p>This section explains what each test in <code>session3_motion_tracking.cpp</code> does <strong>practically</strong> to help you gain real-world understanding.</p>
<h3 id="test-1-vector-operations---building-blocks">Test 1: Vector Operations - Building Blocks </h3>
<p><strong>What it tests:</strong> All fundamental vector operations you'll use in motion tracking.</p>
<h4 id="test-1a-vector-addition">Test 1a: Vector Addition </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 v1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 v2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token number">5.0f</span><span class="token punctuation">,</span> <span class="token number">6.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 sum <span class="token operator">=</span> v1 <span class="token operator">+</span> v2<span class="token punctuation">;</span>
<span class="token comment">// Expected: (5, 7, 9)</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>v1 = Current headset position
v2 = Movement offset (velocity * time)
sum = New headset position after movement

Real OptiTrack scenario:
- Headset at (1, 2, 3)
- User moves (+4, +5, +6) in one frame
- New position: (5, 7, 9)
</code></pre><p><strong>Visual:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>    v2 (4,5,6)
      /
     /
    *-----v1+v2 (5,7,9)
   /
  /
 * v1 (1,2,3)
</code></pre><h4 id="test-1b-magnitude">Test 1b: Magnitude </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> mag <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: 5.0</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>3-4-5 right triangle!
  *
  |\
4 | \  5 (magnitude)
  |  \
  *---*
    3

Real scenario:
- Velocity vector is (3, 4, 0) m/s
- Magnitude = 5.0 m/s = actual speed
- Used to check: "Is surgeon's hand moving too fast?"
</code></pre><h4 id="test-1c-normalization">Test 1c: Normalization </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 norm <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: (0.6, 0.8, 0.0)</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Take direction, remove magnitude:
v = (3, 4, 0), magnitude = 5
normalized = (3/5, 4/5, 0/5) = (0.6, 0.8, 0)

New magnitude = sqrt(0.6² + 0.8²) = 1.0

Real scenario:
- You know velocity is (3, 4, 0)
- You only care about DIRECTION user is moving
- Normalize to get pure direction: (0.6, 0.8, 0)
- Now you can say "move 2 meters in that direction": direction * 2.0
</code></pre><h4 id="test-1d-dot-product">Test 1d: Dot Product </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 v1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// X-axis (right)</span>
Vec3 v2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Y-axis (up)</span>
<span class="token keyword keyword-float">float</span> dot <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: 0.0 (perpendicular!)</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>X-axis (right) and Y-axis (up) are perpendicular.
Dot product = 0 confirms they're 90° apart.

Visual (top view):
     Y (up)
     |
     |
     +------ X (right)

dot(X, Y) = 0 → perpendicular

Real scenario - "Is target in front of me?":
Vec3 forward = headset.forward();
Vec3 toTarget = (target - headset.position).normalize();
float dot = forward.dot(toTarget);

if (dot &gt; 0.7)  → target is in front (&lt; 45° away)
if (dot ≈ 0)    → target is to the side (≈ 90° away)
if (dot &lt; 0)    → target is behind (&gt; 90° away)
</code></pre><h4 id="test-1e-cross-product">Test 1e: Cross Product </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 v1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// X-axis</span>
Vec3 v2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Y-axis</span>
Vec3 cross <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: (0, 0, 1) - Z-axis!</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Cross product finds perpendicular vector.
X × Y = Z (right-hand rule)

Visual:
      Y (up)
      |
      |
      +------ X (right)
     /
    /
   Z (result - forward)

Right-hand rule:
1. Point fingers along X (right)
2. Curl them toward Y (up)
3. Thumb points to Z (forward/out of screen)

Real scenario - "Find camera's right vector":
Vec3 worldUp = {0, 1, 0};
Vec3 cameraForward = camera.forward();
Vec3 cameraRight = worldUp.cross(cameraForward);
// Now you have all 3 axes of camera!
</code></pre><h3 id="test-2-quaternion-rotation---the-core-of-tracking">Test 2: Quaternion Rotation - The Core of Tracking </h3>
<p><strong>What it tests:</strong> Rotating a vector using a quaternion (what OptiTrack does every frame).</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Rotate 90° around Y-axis</span>
Quaternion <span class="token function">rot</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 point <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 rotated <span class="token operator">=</span> rot<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: (0, 0, -1)</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Top view (looking down Y-axis):

Before rotation:           After 90° rotation:
       Z                          Z
       |                          |
       |                          |
       +------ X                  +------ X
      point (1,0,0)            rotated (0,0,-1)

Point at (1, 0, 0) = "to the right"
Rotate 90° around Y = "turn left"
Result: (0, 0, -1) = "now pointing forward"
</code></pre><p><strong>Step-by-step visualization:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. Start: point = (1, 0, 0)

   Top view:
        ↑ Z
        |
   -----+----→ X
        |  *point
        |

2. Rotate 90° around Y (counterclockwise from above)

3. End: rotated = (0, 0, -1)

   Top view:
        ↑ Z
        *rotated
   -----+----→ X
        |
        |
</code></pre><p><strong>Real OptiTrack scenario:</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Headset is rotated 90° to the left (around Y)</span>
Quaternion headsetRotation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>  <span class="token comment">// 90° around Y</span>

<span class="token comment">// In the headset's local space, "forward" is (0, 0, -1)</span>
Vec3 localForward <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// What direction is the user actually looking in world space?</span>
Vec3 worldForward <span class="token operator">=</span> headsetRotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>localForward<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// If headset is rotated 90° left, user is looking along +X axis</span>
</code></pre><p><strong>Why this matters:</strong></p>
<ul>
<li>OptiTrack gives you headset rotation as quaternion</li>
<li>You need to know which direction user is looking</li>
<li>You rotate the local "forward" direction to get world direction</li>
<li>This happens 120+ times per second in VR!</li>
</ul>
<h3 id="test-3-transform-operations---putting-it-all-together">Test 3: Transform Operations - Putting It All Together </h3>
<p><strong>What it tests:</strong> How OptiTrack represents rigid bodies (position + rotation).</p>
<h4 id="test-3a-transformpoint---local-to-world">Test 3a: transformPoint - Local to World </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Transform <span class="token function">headset</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">Quaternion</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 localMarker <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 worldMarker <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>localMarker<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: (2.0, 1.5, 2.9)</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Complete OptiTrack scenario:

1. Headset is in the room at position (2, 1.5, 3)
2. Headset is rotated 90° around Y-axis (facing left)
3. Marker is attached 0.1m to the RIGHT of headset center (local coordinates)
4. Where is the marker in world space?

Step-by-step:
┌─────────────────────────────────────────────────┐
│ STEP 1: Local marker position                  │
│         (0.1, 0, 0) = "0.1m to the right"      │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│ STEP 2: Rotate by headset's rotation           │
│         90° around Y turns "right" into "back"  │
│         (0.1, 0, 0) → (0, 0, -0.1)             │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│ STEP 3: Add headset's position                 │
│         (0, 0, -0.1) + (2, 1.5, 3)             │
│         = (2.0, 1.5, 2.9)                      │
└─────────────────────────────────────────────────┘

Visual (top view):
       Z
       |
   [H] + headset at (2, 1.5, 3), facing left (90° rotated)
       |
       +------ X
       |
       |
     marker at (2.0, 1.5, 2.9) - behind headset in world space
</code></pre><p><strong>Why this matters:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>OptiTrack tracks rigid bodies by their markers.
- Each rigid body has a center position
- Each marker has a FIXED offset from center (in local space)
- To render markers or check tracking quality, you need world positions
- This transform is how you get them!

Real code flow:
for (int i = 0; i &lt; rigidBody-&gt;nMarkers; i++) {
    Vec3 localOffset = rigidBody-&gt;markerLocalPositions[i];
    Vec3 worldPos = rigidBody.transformPoint(localOffset);
    renderMarker(worldPos);
}
</code></pre><h4 id="test-3b-forward---which-way-is-it-facing">Test 3b: forward() - Which Way Is It Facing? </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Transform <span class="token function">headset</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">Quaternion</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 forwardDir <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: (1, 0, 0) - pointing right in world space!</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Headset rotated 90° around Y-axis.
Default forward is (0, 0, -1).
After 90° rotation, forward becomes (1, 0, 0).

Visual (top view):
       Z
       |
Default forward      After 90° rotation:
       ↑
       |                  [H]----→ now forward is RIGHT
   [H] |
       |
       +------ X

Real scenario:
// Place a virtual menu 0.5m in front of user
Vec3 headsetPos = headset.getPosition();
Vec3 lookDir = headset.forward();
Vec3 menuPos = headsetPos + (lookDir * 0.5f);
displayMenu(menuPos);
</code></pre><h4 id="test-3c-up---which-way-is-up-for-this-object">Test 3c: up() - Which Way Is Up For This Object? </h4>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Transform <span class="token function">rotatedCamera</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">Quaternion</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 upDir <span class="token operator">=</span> rotatedCamera<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected: (0, -1, 0) - pointing DOWN!</span>
</code></pre><p><strong>Practical meaning:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Camera flipped upside-down (180° around X-axis).
Default up is (0, 1, 0).
After 180° flip, up becomes (0, -1, 0).

Visual (side view):
  Normal camera:          Flipped camera:
       Y (up)                  Y
       ↑                       |
       |                       |
   [C]-+--→ Z (forward)    [C]-+--→ Z
                               |
                               ↓ (0,-1,0) "up" is now down!

Real scenario - detecting if camera is mounted upside-down:
Vec3 cameraUp = camera.up();
Vec3 worldUp = {0, 1, 0};
float dot = cameraUp.dot(worldUp);

if (dot &lt; -0.9) {
    // Camera is upside-down! Flip the image.
}
</code></pre><h3 id="putting-it-all-together---complete-optitrack-flow">Putting It All Together - Complete OptiTrack Flow </h3>
<p>Here's how all these operations work together in a real VR application:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// FRAME 1: OptiTrack sends data</span>
sRigidBodyData<span class="token operator">*</span> headsetData <span class="token operator">=</span> <span class="token comment">/* from OptiTrack SDK */</span><span class="token punctuation">;</span>

<span class="token comment">// 1. Extract position and rotation (quaternion)</span>
Vec3 position <span class="token operator">=</span> <span class="token punctuation">{</span>headsetData<span class="token operator">-&gt;</span>x<span class="token punctuation">,</span> headsetData<span class="token operator">-&gt;</span>y<span class="token punctuation">,</span> headsetData<span class="token operator">-&gt;</span>z<span class="token punctuation">}</span><span class="token punctuation">;</span>
Quaternion rotation <span class="token operator">=</span> <span class="token punctuation">{</span>headsetData<span class="token operator">-&gt;</span>qx<span class="token punctuation">,</span> headsetData<span class="token operator">-&gt;</span>qy<span class="token punctuation">,</span>
                       headsetData<span class="token operator">-&gt;</span>qz<span class="token punctuation">,</span> headsetData<span class="token operator">-&gt;</span>qw<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2. Create transform</span>
Transform <span class="token function">headset</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. Calculate where user is looking (for rendering, interaction)</span>
Vec3 lookDirection <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. Check if user is looking at target</span>
Vec3 toTarget <span class="token operator">=</span> <span class="token punctuation">(</span>targetPos <span class="token operator">-</span> headset<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> alignment <span class="token operator">=</span> lookDirection<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>toTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>alignment <span class="token operator">&gt;</span> <span class="token number">0.9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Looking almost directly at it</span>
    <span class="token function">highlightTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 5. Calculate velocity (is user moving?)</span>
Vec3 velocity <span class="token operator">=</span> <span class="token punctuation">(</span>position <span class="token operator">-</span> previousPosition<span class="token punctuation">)</span> <span class="token operator">/</span> deltaTime<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> speed <span class="token operator">=</span> velocity<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>speed <span class="token operator">&gt;</span> <span class="token number">2.0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Moving fast</span>
    <span class="token function">enableMotionBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 6. Transform hand controller position to world space</span>
Vec3 localControllerOffset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2f</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Vec3 worldControllerPos <span class="token operator">=</span> headset<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>localControllerOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 7. Check distance to virtual object</span>
Vec3 toObject <span class="token operator">=</span> worldControllerPos <span class="token operator">-</span> virtualObjectPos<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> toObject<span class="token punctuation">.</span><span class="token function">magnitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;</span> <span class="token number">0.1f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Within 10cm</span>
    <span class="token function">grabObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Every test you completed is a step in this pipeline!</strong></p>
<hr>
<p><a name="interview-questions" href=""></a></p>
<h2 id="8-common-interview-questions">8. Common Interview Questions </h2>
<h3 id="conceptual-questions">Conceptual Questions </h3>
<p><strong>Q: What's the difference between a position and a direction vector?</strong></p>
<ul>
<li>Position: A point in space (origin matters)</li>
<li>Direction: A direction and magnitude (origin doesn't matter, often normalized)</li>
</ul>
<p><strong>Q: Why use quaternions instead of Euler angles?</strong></p>
<ul>
<li>No gimbal lock</li>
<li>Smooth interpolation</li>
<li>Easy to combine rotations</li>
<li>Better for real-time systems</li>
</ul>
<p><strong>Q: What does the dot product tell you?</strong></p>
<ul>
<li>How aligned two vectors are</li>
<li>If result &gt; 0: less than 90° apart</li>
<li>If result = 0: perpendicular</li>
<li>If result &lt; 0: more than 90° apart</li>
</ul>
<p><strong>Q: What does the cross product give you?</strong></p>
<ul>
<li>A vector perpendicular to both input vectors</li>
<li>Direction follows right-hand rule</li>
<li>Used to find rotation axes</li>
</ul>
<p><strong>Q: How do you convert from local space to world space?</strong></p>
<ol>
<li>Rotate the local point by the object's rotation</li>
<li>Add the object's position</li>
</ol>
<h3 id="practical-questions">Practical Questions </h3>
<p><strong>Q: Given two points, how do you find the direction from A to B?</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 direction <span class="token operator">=</span> <span class="token punctuation">(</span>B <span class="token operator">-</span> A<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>Q: How do you check if a point is in front of the camera?</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Vec3 toPoint <span class="token operator">=</span> <span class="token punctuation">(</span>point <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 forward <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> dot <span class="token operator">=</span> toPoint<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>forward<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dot <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* in front */</span> <span class="token punctuation">}</span>
</code></pre><p><strong>Q: How do you rotate a vector 90° around the Y-axis?</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>Quaternion <span class="token function">rot</span><span class="token punctuation">(</span>Vec3<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> M_PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vec3 rotated <span class="token operator">=</span> rot<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>originalVec<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="quick-reference-formulas">Quick Reference Formulas </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Vector Operations</span>
magnitude <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x² <span class="token operator">+</span> y² <span class="token operator">+</span> z²<span class="token punctuation">)</span>
normalize <span class="token operator">=</span> v <span class="token operator">/</span> magnitude
<span class="token function">dot</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span> <span class="token operator">=</span> v1<span class="token punctuation">.</span>x<span class="token operator">*</span>v2<span class="token punctuation">.</span>x <span class="token operator">+</span> v1<span class="token punctuation">.</span>y<span class="token operator">*</span>v2<span class="token punctuation">.</span>y <span class="token operator">+</span> v1<span class="token punctuation">.</span>z<span class="token operator">*</span>v2<span class="token punctuation">.</span>z
<span class="token function">cross</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>v1<span class="token punctuation">.</span>y<span class="token operator">*</span>v2<span class="token punctuation">.</span>z <span class="token operator">-</span> v1<span class="token punctuation">.</span>z<span class="token operator">*</span>v2<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
                 v1<span class="token punctuation">.</span>z<span class="token operator">*</span>v2<span class="token punctuation">.</span>x <span class="token operator">-</span> v1<span class="token punctuation">.</span>x<span class="token operator">*</span>v2<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
                 v1<span class="token punctuation">.</span>x<span class="token operator">*</span>v2<span class="token punctuation">.</span>y <span class="token operator">-</span> v1<span class="token punctuation">.</span>y<span class="token operator">*</span>v2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>

<span class="token comment">// Quaternion from axis-angle</span>
half <span class="token operator">=</span> angle <span class="token operator">/</span> <span class="token number">2</span>
q<span class="token punctuation">.</span>x <span class="token operator">=</span> axis<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>y <span class="token operator">=</span> axis<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>z <span class="token operator">=</span> axis<span class="token punctuation">.</span>z <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span>

<span class="token comment">// Transform point</span>
worldPos <span class="token operator">=</span> rotation<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>localPos<span class="token punctuation">)</span> <span class="token operator">+</span> position
</code></pre><hr>
<h2 id="key-takeaways">Key Takeaways </h2>
<p>✓ <strong>Vectors</strong> represent positions, directions, velocities in 3D<br>
✓ <strong>Dot product</strong> measures alignment (cos of angle)<br>
✓ <strong>Cross product</strong> finds perpendicular vectors<br>
✓ <strong>Normalize</strong> to get direction without magnitude<br>
✓ <strong>Quaternions</strong> avoid gimbal lock (critical for VR!)<br>
✓ <strong>Transforms</strong> combine position + rotation<br>
✓ <strong>Local → World</strong> transformation: rotate then translate</p>
<p><strong>You're now equipped to tackle Session 3 exercises!</strong> 🚀</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>